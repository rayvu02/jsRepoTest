//Ensure the root element is created so the widget can be mounted
function ensureRootElement() {
  const existingRoot = document.getElementById("rv-site-root");
  if (existingRoot) {
    return existingRoot;
  }

  const root = document.createElement("div");
  root.id = "rv-site-root";
  root.className = "rv-widget";
  placeRootElement(root);
  return root;
}

//Place the root element in the DOM
function placeRootElement(root) {
  if (!document.body) {
    document.documentElement.appendChild(root);
    return;
  }

  const anchor = findAnchorElement();
  if (anchor?.parentNode) {
    anchor.insertAdjacentElement("afterend", root);
    return;
  }

  document.body.appendChild(root);
}

// find the last nav or header element
function findAnchorElement() {
  const anchors = document.querySelectorAll("nav, header");
  if (anchors.length === 0) {
    return null;
  }

  return anchors[anchors.length - 1] ?? null;
}

//Create the content for the widget
function renderHelloContent(target) {
  target.innerHTML = "";

  const heading = document.createElement("h1");
  heading.textContent = "Hello, Website!";

  const paragraph = document.createElement("p");
  paragraph.textContent = "This content was generated by calling a JavaScript function.";

  target.appendChild(heading);
  target.appendChild(paragraph);
}

//Mount the widget to the page
function mountHelloWidget() {
  try {
    const root = ensureRootElement();
    renderHelloContent(root);
  } catch (error) {
    console.error("sitescript.js failed to mount:", error);
  }
}

//Initialize the widget
function initializeWidget() {
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", mountHelloWidget, { once: true });
    return;
  }

  mountHelloWidget();
}

initializeWidget();

if (typeof window !== "undefined") {
  window.rvMountHelloWidget = mountHelloWidget;
}